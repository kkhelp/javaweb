<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!--  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">-->
  <link rel="stylesheet" href="../static/css/elementcss.css">
  <link rel="stylesheet" href="../static/css/homework2.css">
  <title>修改密码</title>
</head>
<body>
<h1>修改密码，默认修改王五的密码</h1>
<form class="el-form" action="/modifyPasd" method="post">
  <div class="el-form-item is-required">
    <label class="el-form-item__label" for="oldPasd">旧密码：</label>
    <div class="el-form-item__content">
      <div class="el-input">
        <input class="el-input__inner" type="password" name="oldPasd" id="oldPasd">
      </div>
      <div class="el-form-item__error hide-element">密码格式不正确</div>
    </div>
  </div>
  <div class="el-form-item is-required">
    <label class="el-form-item__label" for="newPasd">新密码：</label>
    <div class="el-form-item__content">
      <div class="el-input">
        <input class="el-input__inner" type="password" name="newPasd" id="newPasd">
      </div>
      <div class="el-form-item__error hide-element">密码格式不正确</div>
    </div>
  </div>
  <div class="el-form-item is-required">
    <label class="el-form-item__label" for="cfPassword">确认密码：</label>
    <div class="el-form-item__content">
      <div class="el-input">
        <input class="el-input__inner" type="password" name="cfPassword" id="cfPassword">
      </div>
      <div class="el-form-item__error hide-element">密码格式不正确</div>
    </div>
  </div>
  <div class="el-form-item">
    <div class="el-form-item__content">
      <button type="submit" class="el-button el-button--primary">提交</button>
    </div>
  </div>
  </div>
</form>
</body>
<!--<script type="text/javascript" src="../static/js/createForm.js"></script>-->
<script type="text/javascript">
  let inputs = document.getElementsByClassName("el-input__inner");
  let rxgPsw = /[0-9a-zA-z_]{6,12}/;
  let isPsw1 = false;
  let isPsw2 = false;
  let isPsw3 = false;
  // 新密码
  let password = "";

  for (let i = 0; i < inputs.length; i++) {
    inputs[i].addEventListener("input", e => {
      let name = e.target.name;
      if (name === "oldPasd") {
        isPsw1 = rxgPsw.test(e.target.value);
        handleClass(isPsw1, e);
      }
      if (name === "newPasd") {
        isPsw2 = rxgPsw.test(e.target.value);
        password = e.target.value;
        handleClass(isPsw2, e);
      }
      if (name === "cfPassword") {
        isPsw3 = rxgPsw.test(e.target.value) && e.target.value === password;
        handleClass(isPsw3, e, rxgPsw.test(e.target.value));
      }
    })
  }

  function handleClass(isFlag, e, test) {
    let error = e.target?.parentNode?.nextElementSibling;
    let formItem = e.target?.parentNode?.parentNode?.parentNode;
    isFlag ? formItem.classList?.remove("is-error") : formItem.classList?.add("is-error");
    if (e.target.name === "cfPassword") {
      if (test && e.target.value !== password) {
        error.innerText = "两次密码不一致";
      } else if (!test) {
        error.innerText = "密码格式不正确";
      }
    }
    error.classList?.remove(isFlag ? "show-element" : "hide-element");
    error.classList?.add(isFlag ? "hide-element" : "show-element");
  }

  let btn = document.getElementsByClassName("el-button")[0];
  btn.addEventListener("click", e => {
    /*event.preventDefault();
    if (isPsw1 && isPsw2 && isPsw3) {
      alert("修改成功");
    } else {
      console.log("error");
    }*/
  })
</script>
</html>
